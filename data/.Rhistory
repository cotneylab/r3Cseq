head(fixed.data)
i=2#
	s.file <-peak.files[i]
s.peaks<-read.table(paste("sig.peaks.filtered/",peak.files[i],sep=""),header=T)#
		s.iranges <-RangedData(space=as.character(s.peaks$chromosome),IRanges(start=s.peaks$peak_center-250,end=s.peaks$peak_center+250),idx=1:nrow(s.peaks))
i=1#
			q.row<-fixed.data[i,]#
			q.iranges <-RangedData(space=as.character(q.row$chromosome),IRanges(start=q.row$peak_center-250,end=q.row$peak_center+250))
q.iranges
o <- findOverlaps(q.iranges ,subject=s.iranges)#
			ol <-data.frame(as.data.frame(q.iranges[queryHits(o),]),as.data.frame(s.iranges[subjectHits(o),]))
ol
s.peaks<-read.table(paste("sig.peaks.filtered/",peak.files[i],sep=""),header=T)#
		s.iranges <-RangedData(space=as.character(s.peaks$chromosome),IRanges(start=s.peaks$peak_center-250,end=s.peaks$peak_center+250),peak_center=s.peaks$peak_center,idx=1:nrow(s.peaks))
	i=1#
			q.row<-fixed.data[i,]#
			q.iranges <-RangedData(space=as.character(q.row$chromosome),IRanges(start=q.row$peak_center-250,end=q.row$peak_center+250),peak_center=q.peak$peak_center)#
			#
			o <- findOverlaps(q.iranges ,subject=s.iranges)#
			ol <-data.frame(as.data.frame(q.iranges[queryHits(o),]),as.data.frame(s.iranges[subjectHits(o),]))
i=1#
			q.row<-fixed.data[i,]#
			q.iranges <-RangedData(space=as.character(q.row$chromosome),IRanges(start=q.row$peak_center-250,end=q.row$peak_center+250),peak_center=q.row$peak_center)#
			#
			o <- findOverlaps(q.iranges ,subject=s.iranges)#
			ol <-data.frame(as.data.frame(q.iranges[queryHits(o),]),as.data.frame(s.iranges[subjectHits(o),]))
ol
	i=2#
			q.row<-fixed.data[i,]#
			q.iranges <-RangedData(space=as.character(q.row$chromosome),IRanges(start=q.row$peak_center-250,end=q.row$peak_center+250),peak_center=q.row$peak_center)#
			#
			o <- findOverlaps(q.iranges ,subject=s.iranges)#
			ol <-data.frame(as.data.frame(q.iranges[queryHits(o),]),as.data.frame(s.iranges[subjectHits(o),]))
ol
	s.iranges <-RangedData(space=as.character(s.peaks$chromosome),IRanges(start=s.peaks$peak_center-250,end=s.peaks$peak_center+250),peak_center=s.peaks$peak_center,idx=1:nrow(s.peaks))
s.iranges
i=2#
			q.row<-fixed.data[i,]#
			q.iranges <-RangedData(space=as.character(q.row$chromosome),IRanges(start=q.row$peak_center-250,end=q.row$peak_center+250),peak_center=q.row$peak_center)
q.iranges
o <- findOverlaps(q.iranges ,subject=s.iranges)#
			ol <-data.frame(as.data.frame(q.iranges[queryHits(o),]),as.data.frame(s.iranges[subjectHits(o),]))
ol
for(i in c(1:nrow(fixed.data))){#
			q.row<-fixed.data[i,]#
			q.iranges <-RangedData(space=as.character(q.row$chromosome),IRanges(start=q.row$peak_center-250,end=q.row$peak_center+250),peak_center=q.row$peak_center)#
			#
			o <- findOverlaps(q.iranges ,subject=s.iranges)#
			ol <-data.frame(as.data.frame(q.iranges[queryHits(o),]),as.data.frame(s.iranges[subjectHits(o),]))#
			print(ol)#
		}
	q.row<-fixed.data[i,]#
			q.iranges <-RangedData(space=as.character(q.row$chromosome),IRanges(start=q.row$peak_center-250,end=q.row$peak_center+250),peak_center=q.row$peak_center)
q.iranges
o <- findOverlaps(q.iranges ,subject=s.iranges)
o
ol <-data.frame(as.data.frame(q.iranges[queryHits(o),]),as.data.frame(s.iranges[subjectHits(o),]))
ol
library(IRanges)#
q.file<-"p300.chip.ni.peaks.sorted.txt"#
q.peaks<-read.table(paste("sig.peaks.filtered/",q.file,sep=""),header=T)#
#
peak.files<-c("p300.chip.ni.peaks.sorted.txt","polII.chip.ni.peaks.sorted.txt","ctcf.chip.ni.peaks.sorted.txt","gata1.chip.ni.peaks.sorted.txt",#
		"ldb1.chip.ni.peaks.sorted.txt","tal1.chip.ni.peaks.sorted.txt","runx1.chip.ni.peaks.sorted.txt","eto2.chip.ni.peaks.sorted.txt","gfi1b.chip.ni.peaks.sorted.txt",#
		"fog1.chip.ni.peaks.sorted.txt","lsd1.chip.ni.peaks.sorted.txt","lmo2.chip.ni.peaks.sorted.txt","lmo4.chip.ni.peaks.sorted.txt","tfi1g.chip.ni.peaks.sorted.txt")#
#
fixed.data<-data.frame(chromosome=q.peaks$chromosome,start=q.peaks$start,end=q.peaks$end,peak_center=q.peaks$peak_center,q.peaks$quantiles.ni,q.peaks$quantiles.ni)#
name <- unlist(strsplit(q.file, "\\."))#
f.name<-name[1]#
colnames(fixed.data)<-c("chromosome","start","end","peak_center",paste(f.name,".ni",sep=""),paste(f.name,".in",sep=""))
head(fixed.data)
i=2#
	s.file <-peak.files[i]
s.file
s.peaks<-read.table(paste("sig.peaks.filtered/",s.files[i],sep=""),header=T)
s.peaks<-read.table(paste("sig.peaks.filtered/",s.file[i],sep=""),header=T)#
		s.iranges <-RangedData(space=as.character(s.peaks$chromosome),IRanges(start=s.peaks$peak_center-250,end=s.peaks$peak_center+250),peak_center=s.peaks$peak_center,idx=1:nrow(s.peaks))
s.peaks<-read.table(paste("sig.peaks.filtered/",s.file,sep=""),header=T)#
		s.iranges <-RangedData(space=as.character(s.peaks$chromosome),IRanges(start=s.peaks$peak_center-250,end=s.peaks$peak_center+250),peak_center=s.peaks$peak_center,idx=1:nrow(s.peaks))
s.iranges
j=1#
			q.row<-fixed.data[j,]#
			q.iranges <-RangedData(space=as.character(q.row$chromosome),IRanges(start=q.row$peak_center-250,end=q.row$peak_center+250),peak_center=q.row$peak_center)
q.iranges
head(fixed.data)
o <- findOverlaps(q.iranges ,subject=s.iranges)#
			ol <-data.frame(as.data.frame(q.iranges[queryHits(o),]),as.data.frame(s.iranges[subjectHits(o),]))
ol
?findOverlaps
o <- findOverlaps(q.iranges ,subject=s.iranges,minoverlap = 200L)#
			ol <-data.frame(as.data.frame(q.iranges[queryHits(o),]),as.data.frame(s.iranges[subjectHits(o),]))
ol
ol$dist<-ol$peak_center-ol$peak_center.1
ol
head(q.peaks)
n.data<-data.frame(quantiles.ni=s.peak$quantiles.ni[ol$idx],quantiles.in=s.peak$quantiles.in[ol$idx])
n.data<-data.frame(quantiles.ni=s.peaks$quantiles.ni[ol$idx],quantiles.in=s.peaks$quantiles.in[ol$idx])
n.data
s.peaks[10535,]
s.name <- unlist(strsplit(s.file, "\\."))
s.name
ol<-ol[1,]#
				n.data<-data.frame(quantiles.ni=s.peaks$quantiles.ni[ol$idx],quantiles.in=s.peaks$quantiles.in[ol$idx])#
				s.name <- unlist(strsplit(s.file, "\\."))#
				colnames(n.data)<-c(paste(s.name[1],".ni",sep=""),paste(s.name[1],".in",sep=""))
n.data
s.peaks<-read.table(paste("sig.peaks.filtered/",s.file,sep=""),header=T)#
		s.iranges <-RangedData(space=as.character(s.peaks$chromosome),IRanges(start=s.peaks$peak_center-250,end=s.peaks$peak_center+250),peak_center=s.peaks$peak_center,idx=1:nrow(s.peaks))#
		each.factor <-data.frame()#
		for(j in c(1:nrow(fixed.data))){#
			q.row<-fixed.data[j,]#
			q.iranges <-RangedData(space=as.character(q.row$chromosome),IRanges(start=q.row$peak_center-250,end=q.row$peak_center+250),peak_center=q.row$peak_center)#
			#
			o <- findOverlaps(q.iranges ,subject=s.iranges,minoverlap = 200L)#
			ol <-data.frame(as.data.frame(q.iranges[queryHits(o),]),as.data.frame(s.iranges[subjectHits(o),]))#
			ol$dist<-ol$peak_center-ol$peak_center.1#
			ol <-ol[order(abs(ol$dist)),]#
			if(nrow(ol) > 0){#
				ol<-ol[1,]#
				n.data<-data.frame(quantiles.ni=s.peaks$quantiles.ni[ol$idx],quantiles.in=s.peaks$quantiles.in[ol$idx])#
				s.name <- unlist(strsplit(s.file, "\\."))#
				colnames(n.data)<-c(paste(s.name[1],".ni",sep=""),paste(s.name[1],".in",sep=""))#
				each.factor <-rbind(each.factor,n.data)#
			}else{#
				n.data<-data.frame(quantiles.ni=0,quantiles.in=0)#
				s.name <- unlist(strsplit(s.file, "\\."))#
				colnames(n.data)<-c(paste(s.name[1],".ni",sep=""),paste(s.name[1],".in",sep=""))#
				each.factor <-rbind(each.factor,n.data)#
			}#
		}
head(each.factor)
exit
quit()
library(IRanges)#
q.file<-"p300.chip.ni.peaks.sorted.txt"#
q.peaks<-read.table(paste("sig.peaks.filtered/",q.file,sep=""),header=T)#
#
peak.files<-c("p300.chip.ni.peaks.sorted.txt","polII.chip.ni.peaks.sorted.txt","ctcf.chip.ni.peaks.sorted.txt","gata1.chip.ni.peaks.sorted.txt",#
		"ldb1.chip.ni.peaks.sorted.txt","tal1.chip.ni.peaks.sorted.txt","runx1.chip.ni.peaks.sorted.txt","eto2.chip.ni.peaks.sorted.txt","gfi1b.chip.ni.peaks.sorted.txt",#
		"fog1.chip.ni.peaks.sorted.txt","lsd1.chip.ni.peaks.sorted.txt","lmo2.chip.ni.peaks.sorted.txt","lmo4.chip.ni.peaks.sorted.txt","tfi1g.chip.ni.peaks.sorted.txt")#
#
fixed.data<-data.frame(chromosome=q.peaks$chromosome,start=q.peaks$start,end=q.peaks$end,peak_center=q.peaks$peak_center,q.peaks$quantiles.ni,q.peaks$quantiles.ni)#
name <- unlist(strsplit(q.file, "\\."))#
f.name<-name[1]#
colnames(fixed.data)<-c("chromosome","start","end","peak_center",paste(f.name,".ni",sep=""),paste(f.name,".in",sep=""))
install.packages("sqldf")
	i=2#
	s.file <-peak.files[i]
s.file
s.peaks<-read.table(paste("sig.peaks.filtered/",s.file,sep=""),header=T)#
			s.iranges <-RangedData(space=as.character(s.peaks$chromosome),IRanges(start=s.peaks$peak_center-250,end=s.peaks$peak_center+250),peak_center=s.peaks$peak_center,idx=1:nrow(s.peaks))
s.iranges
q.iranges <-RangedData(space=as.character(q.peaks$chromosome),IRanges(start=q.peaks$peak_center-250,end=q.peaks$peak_center+250),peak_center=q.peaks$peak_center)#
			o <- findOverlaps(q.iranges ,subject=s.iranges,minoverlap = 200L)#
			ol <-data.frame(as.data.frame(q.iranges[queryHits(o),]),as.data.frame(s.iranges[subjectHits(o),]))
head(ol)
nrow(ol)
	ol$dist<-ol$peak_center-ol$peak_center.1
head(ol)
head(ol,n=30)
library(sqldf)
sqldf('select Species, avg("Sepal.Length") frm iris group by Species')
head(ol,n=30)
sqldf('select space, start, end, peak_center from ol group by peak_center')
x<-sqldf('select space, start, end, peak_center from ol group by peak_center')
head(x)
head(ol)
nrow(ol)
nrow(x)
x<-sqldf('select space, start, end, peak_center from ol group by peak_center order by abs(dist)')
head(x)
34200/ยง2
34200/12
ecdf
x<-rnorm(20)
x
plot(ecdf(x))
Fn(x)
x
y<-ecdf(x)
y
summary(y)
180000/12
180000/72
180000/60
library(affy)
normalize.quantiles
?normalize.quantiles
??normalize.quantiles
library(affy)
?mva.pairs
library(r3Cseq)
?vignette(r3Cseq)
vignette("r3Cseq")
library(r3Cseq)
vigentte("r3Cseq")
vigenette("r3Cseq")
vignette("r3Cseq")
Aligned3CseqMybFetalBrain<-system.file("extdata",#
 "alignedReads.fetal.brain.subset.bam",package="r3Cseq")#
Aligned3CseqMybFetalLiver<-system.file("extdata",#
"alignedReads.fetal.liver.subset.bam",package="r3Cseq")
expFile<-Aligned3CseqMybFetalLiver
expFile
contrFile<-Aligned3CseqMybFetalBrain
my3Cseq.obj<-new("r3Cseq",organismName='mm9',alignedReadsBamExpFile=expFile,+ alignedReadsBamContrFile=contrFile,isControlInvolved=TRUE,+ isBamInputFile=TRUE,expLabel="fetal_liver",+ contrLabel="fetal_brain",restrictionEnzyme='HindIII')
my3Cseq.obj<-new("r3Cseq",organismName='mm9',alignedReadsBamExpFile=expFile,#
 alignedReadsBamContrFile=contrFile,isControlInvolved=TRUE,#
isBamInputFile=TRUE,expLabel="fetal_liver",#
contrLabel="fetal_brain",restrictionEnzyme='HindIII')
my3Cseq.obj
getReadCountPerRestrictionFragment(my3Cseq.obj)
calculateRPM(my3Cseq.obj)
getInteractions(my3Cseq.obj)
fetal.liver.interactions <-expInteractionRegions(my3Cseq.obj)
fetal.liver.interactions
fetal.brain.interactions <- contrInteractionRegions(my3Cseq.obj)
fetal.brain.interactions
viewpoint<-getViewpoint(my3Cseq.obj)
viewpoint
plotOverviewInteractions(my3Cseq.obj)
plot3Cecdf(my3Cseq.obj)
plotInteractionsNearViewpoint(my3Cseq.obj)
plotInteractionsPerChromosome(my3Cseq.obj,"chr10")
export3Cseq2bedGraph(my3Cseq.obj)
generate3CseqReport(my3Cseq.obj)
300000/12
400000-(.36*400000)
256000/12
450000-(.36*450000)
288000/12
library(r3Cseq)
31300/12
375/450
15000/60
150000/60
150000/72
150000/60
1660*60
175112/60
175112/84
library(r3Cseq)
vignette("r3Cseq")
350/384
library(IRanges)
Rle
?Rle
	coefs.vec<-coefs.vec[1:10]#
	coefs.cov<-Rle(coefs.vec,1)
test<-Rle(1:10,1)
test<-Rle(1:10,rep(1,10))
test
test<-Rle(rep(1,10),1:10)
test
test<-Rle(rep(1,10),1:10)
test
?IRanges
x<-as.vector(IRanges(3,5))
x<-as.vector(IRanges(start=3,end=5))
as.vector(IRanges(3,5))
IRanges(3,5)
as.vector(IRanges(3,5))
as.integer(IRanges(3,5))
test.rle<-Rle(rep(1,100))
test.rle
?rep
rep(c(1),each=10)
x<-Rle(1,1:10)
library(IRanges)
x<-Rle(1,1:10)
x<-Rle(rep(1,10),1:10)
x
x<-Rle(,1:10)
Rle(rep(1,100))
x<-Rle(rep(1,100))
x
runValue(x[1:10])<-3
x
?rep
rep(1:4, each = 2, len = 10)
x<-data.frame(start=c(1,5,10,15),end=c(3,7,12,17),value=c(0.5,1,0.2,0.4))
x
rep(x$value,each=x$end-x$start+1)
p  <-as.vector(IRanges(x$start,x$end))
p  <-unlist(as.vector(IRanges(x$start,x$end)))
p  <-as.integer(IRanges(x$start,x$end))
p
ex.rle<-Rle(rep(1,100))
ex.rle
ex.rle[p]<-rep(x$value,x$end-x$start+1)
ex.rle
runValue(ex.rle)
ex.rle[p]<-rep(x$value,x$end-x$start+2)
ex.rle[p]<-rep(x$value,x$end-x$start+3)
ex.rle[p]<-rep(x$value,x$end-x$start+1)
ex.rle
x<-data.frame(start=c(5,20,45,60),end=c(8,25,50,67),value=c(0.5,1,0.2,0.4))
x
ex.rle<-Rle(rep(1,100))
ex.rle
p  <-as.integer(IRanges(x$start,x$end))
p
ex.rle[p]<-rep(x$value,x$end-x$start+1)
ex.rle
x<-data.frame(start=c(5,10,45,60),end=c(8,15,50,70),value=c(0.5,1,0.2,0.4))
ex.rle<-Rle(rep(1,100))
p  <-as.integer(IRanges(x$start,x$end))
p
x
ex.rle[p]<-rep(x$value,(x$end-x$start+1))
ex.rle
runSums(ex.rle)
length(ex.rle)
sum(ex.rle)
?Rle
runLength(ex.rle)
cumsum(runLength(ex.rle))
?Rle
start(ex.rle)
?rep
ex.rle[p]<-rep(x$value,each=x$end-x$start)
ex.rle[p]<-rep(x$value,each=(x$end-x$start+1))
x
x$width<-x$end-x$start+1
x
ex.rle[p]<-rep(x$value,each=x$width)
ex.rle[p]<-rep(x$value,x$width)
ex.rle
1568/270
36977038-36976569
5.8/469
(5.8/469)*200
5.892857*1154
0.5461812*614
5.892857*195
1154/195
1775*0.54
3234*0.5489954
270*5.789668
173000-13584
186584-13584
library(r3Cseq)
?r3Cseq
library(BSgenome.Mmusculus.UCSC.mm9)#
    expFile<-system.file("extdata","alignedReads.fetal.liver.subset.bam",package="r3Cseq")#
    contrFile<-system.file("extdata","alignedReads.fetal.brain.subset.bam",package="r3Cseq")#
	#
	my.data<-new("r3Cseq",organismName='mm9',alignedReadsBamExpFile=expFile,#
	alignedReadsBamContrFile=contrFile,isControlInvolved=TRUE,isBamInputFile=TRUE,#
	expLabel="fetal_liver",contrLabel="fetal_brain",#
	restrictionEnzyme='HindIII')#
	#
	getReadCountPerRestrictionFragment(my.data)
my.data
save(my.data,"example.data.rda")
save(my.data,file="example.data.rda")
my.data
